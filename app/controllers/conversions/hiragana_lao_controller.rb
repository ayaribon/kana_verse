class Conversions::HiraganaLaoController < ApplicationController
  def hiragana_to_lao
    @hiragana = params[:hiragana]
    if @hiragana.present?
      @lao_result = convert_hiragana_to_lao(@hiragana)
      redirect_to hiragana_to_lao_result_path(hiragana: @hiragana, lao_result: @lao_result)
    else
      flash[:error] = "ひらがなを入力してください"
      render "conversions/hiragana_lao/hiragana_to_lao"
    end
  end

  def hiragana_to_lao_result
    @hiragana = params[:hiragana]
    @lao_result = params[:lao_result]
  end

  private

  def convert_hiragana_to_lao(hiragana)
    hiragana_to_lao_long = {
      "あ" => "ອາ",
      "い" => "ອີ",
      "う" => "ອູ",
      "え" => "ເອ",
      "お" => "ໂອ",

      # か行
      "か" => "ຄາ",
      "き" => "ຄີ",
      "く" => "ຄູ",
      "け" => "ເຄ",
      "こ" => "ໂຄ",

      # さ行
      "さ" => "ຊາ",
      "し" => "ຊີ",
      "す" => "ຊູ",
      "せ" => "ເຊ",
      "そ" => "ໂຊ",

      # た行
      "た" => "ຕາ",
      "ち" => "ຈີ",
      "つ" => "ສູ",
      "て" => "ເຕ",
      "と" => "ໂຕ",
      "っ" => "ສ",

      # な行
      "な" => "ນາ",
      "に" => "ນີ",
      "ぬ" => "ນູ",
      "ね" => "ເນ",
      "の" => "ໂນ",

      # は行
      "は" => "ຮາ",
      "ひ" => "ຮີ",
      "ふ" => "ຮູ",
      "へ" => "ເຮ",
      "ほ" => "ໂຮ",

      # ま行
      "ま" => "ມາ",
      "み" => "ມີ",
      "む" => "ມູ",
      "め" => "ເມ",
      "も" => "ໂມ",

      # や行
      "や" => "ຢາ",
      "ゆ" => "ຢູ",
      "よ" => "ໂຢ",

      # ら行
      "ら" => "ຣາ",
      "り" => "ຣີ",
      "る" => "ຣູ",
      "れ" => "ເຣ",
      "ろ" => "ໂຣ",

      # わ行
      "わ" => "ວາ",
      "を" => "ໂອ",
      "ん" => "ນ",

      # が行
      "が" => "ກາ",
      "ぎ" => "ກີ",
      "ぐ" => "ກູ",
      "げ" => "ເກ",
      "ご" => "ໂກ",

      # ざ行
      "ざ" => "ຊາ",
      "じ" => "ຈີ",
      "ず" => "ຊູ",
      "ぜ" => "ເຊ",
      "ぞ" => "ໂຊ",

      # ば行
      "ば" => "ບາ",
      "び" => "ບີ",
      "ぶ" => "ບູ",
      "べ" => "ເບ",
      "ぼ" => "ໂບ",

      # ぱ行
      "ぱ" => "ປາ",
      "ぴ" => "ປີ",
      "ぷ" => "ປູ",
      "ぺ" => "ເປ",
      "ぽ" => "ໂປ",

      # だ行
      "だ" => "ດາ",
      "ぢ" => "ຈີ",
      "づ" => "ສູ",
      "で" => "ເດ",
      "ど" => "ໂດ",

      # きゃ行
      "きゃ" => "ເຄຍ",
      "きゅ" => "ຄີວ",
      "きょ" => "ຄຽວ",

      # しゃ行
      "しゃ" => "ເຊຍ",
      "しゅ" => "ຊີວ",
      "しょ" => "ຊຽວ",

      # ちゃ行
      "ちゃ" => "ຈາ",
      "ちゅ" => "ຈູ",
      "ちょ" => "ໂຈ",

      # にゃ行
      "にゃ" => "ຍາ",
      "にゅ" => "ຍູ",
      "にょ" => "ໂຍ",

      # ひゃ行
      "ひゃ" => "ເຮຍ",
      "ひゅ" => "ຮີວ",
      "ひょ" => "ຮຽວ",

      # みゃ行
      "みゃ" => "ເມຍ",
      "みゅ" => "ມີວ",
      "みょ" => "ມຽວ",

      # りゃ行
      "りゃ" => "ເຣຍ",
      "りゅ" => "ຣີວ",
      "りょ" => "ຣຽວ",

      # ぎゃ行
      "ぎゃ" => "ເກຍ",
      "ぎゅ" => "ກີວ",
      "ぎょ" => "ກຽວ",

      # じゃ行
      "じゃ" => "ຈາ",
      "じゅ" => "ຈູ",
      "じょ" => "ໂຈ",

      # びゃ行
      "びゃ" => "ເບຍ",
      "びゅ" => "ບີວ",
      "びょ" => "ບຽວ",

      # ぴゃ行
      "ぴゃ" => "ເປຍ",
      "ぴゅ" => "ປີວ",
      "ぴょ" => "ປຽວ",

     # だぁ行
     "だぁ" => "ດາ", "でぃ" => "ດີ", "どぅ" => "ດູ", "でぇ" => "ເດ", "どぉ" => "ໂດ",

     # ヴぁ行
     "ヴぁ" => "ວາ", "ヴぃ" => "ວີ", "ヴぅ" => "ວູ", "ヴぇ" => "ເວ", "ヴぉ" => "ໂວ"
    }

    hiragana_to_lao_short = {
      "あ" => "ອະ", "い" => "ອິ", "う" => "ອຸ", "え" => "ເອະ", "お" => "ໂອະ",

      # か行
      "か" => "ຄະ", "き" => "ຄິ", "く" => "ຄຸ", "け" => "ເຄະ", "こ" => "ໂຄະ",

      # さ行
      "さ" => "ຊະ", "し" => "ຊິ", "す" => "ຊຸ", "せ" => "ເຊະ", "そ" => "ໂຊະ",

      # た行
      "た" => "ຕະ", "ち" => "ຈິ", "つ" => "ສຸ", "て" => "ເຕະ", "と" => "ໂຕະ",
      "っ" => "ສ",

      # な行
      "な" => "ນະ", "に" => "ນິ", "ぬ" => "ນຸ", "ね" => "ເນະ", "の" => "ໂນະ",

      # は行
      "は" => "ຮະ", "ひ" => "ຮິ", "ふ" => "ຮຸ", "へ" => "ເຮະ", "ほ" => "ໂຮະ",

      # ま行
      "ま" => "ມະ", "み" => "ມິ", "む" => "ມຸ", "め" => "ເມະ", "も" => "ໂມະ",

      # や行
      "や" => "ຢະ", "ゆ" => "ຢຸ", "よ" => "ໂຢະ",

      # ら行
      "ら" => "ຣະ", "り" => "ຣິ", "る" => "ຣຸ", "れ" => "ເຣະ", "ろ" => "ໂຣະ",

      # わ行
      "わ" => "ວະ", "を" => "ໂອະ", "ん" => "ນ",
      # が行
      "が" => "ກະ", "ぎ" => "ກິ", "ぐ" => "ກຸ",
      "げ" => "ເກະ", "ご" => "ໂກະ",
      # ざ行
      "ざ" => "ຊະ", "じ" => "ຈິ", "ず" => "ຊຸ",
      "ぜ" => "ເຊະ", "ぞ" => "ໂຊະ",
      # だ行
      "だ" => "ດະ", "ぢ" => "ຈິ", "づ" => "ສຸ",
      "で" => "ເດະ", "ど" => "ໂດະ",

      # ば行
      "ば" => "ບະ",
      "び" => "ບິ",
      "ぶ" => "ບຸ",
      "べ" => "ເບະ",
      "ぼ" => "ໂບະ",

      # ぱ行
      "ぱ" => "ປະ",
      "ぴ" => "ປິ",
      "ぷ" => "ປຸ",
      "ぺ" => "ເປະ",
      "ぽ" => "ໂປະ",

      # きゃ行
      "きゃ" => "ເຄັຍ", "きゅ" => "ຄິວ", "きょ" => "ຄຽວ",

      # しゃ行
      "しゃ" => "ເຊັຍ", "しゅ" => "ຊິວ", "しょ" => "ຊຽວ",

      # ちゃ行
      "ちゃ" => "ຈະ", "ちゅ" => "ຈຸ", "ちょ" => "ໂຈະ",

      # にゃ行
      "にゃ" => "ຍະ", "にゅ" => "ຍຸ", "にょ" => "ໂຍະ",

      # ひゃ行
      "ひゃ" => "ເຮັຍ", "ひゅ" => "ຮິວ", "ひょ" => "ຮຽວ",

      # みゃ行
      "みゃ" => "ເມັຍ", "みゅ" => "ມິວ", "みょ" => "ມຽວ",

      # りゃ行
      "りゃ" => "ເຣັຍ", "りゅ" => "ຣິວ", "りょ" => "ຣຽວ",

      # ぎゃ行
      "ぎゃ" => "ເກັຍ", "ぎゅ" => "ກິວ", "ぎょ" => "ກຽວ",

      # じゃ行
      "じゃ" => "ຈະ", "じゅ" => "ຈຸ", "じょ" => "ໂຈະ",

      # びゃ行
      "びゃ" => "ເບັຍ", "びゅ" => "ບິວ", "びょ" => "ບຽວ",

      # ぴゃ行
      "ぴゃ" => "ເປັຍ", "ぴゅ" => "ປິວ", "ぴょ" => "ປຽວ",

     # だぁ行
     "だぁ" => "ດາ", "でぃ" => "ດີ", "どぅ" => "ດູ", "でぇ" => "ເດ", "どぉ" => "ໂດ",

     # ヴぁ行
     "ヴぁ" => "ວະ", "ヴぃ" => "ວິ", "ヴぅ" => "ວຸ", "ヴぇ" => "ເວະ", "ヴぉ" => "ໂວະ"
    }

    hiragana_to_lao_special = {
      "あ" => "ອັ", "い" => "ອິ", "う" => "ອຸ", "え" => "ເອັ", "お" => "ອົ",

      # か行
      "か" => "ຄັ", "き" => "ຄິ", "く" => "ຄຸ", "け" => "ເຄັ", "こ" => "ຄົ",

      # さ行
      "さ" => "ຊັ", "し" => "ຊິ", "す" => "ຊຸ", "せ" => "ເຊັ", "そ" => "ຊົ",

      # た行
      "た" => "ຕັ", "ち" => "ຈິ", "つ" => "ສຸ", "て" => "ເຕັ", "と" => "ຕົ", "っ" => "ສ",

      # な行
      "な" => "ນັ", "に" => "ນິ", "ぬ" => "ນຸ", "ね" => "ເນັ", "の" => "ນົ",

      # は行
      "は" => "ຮັ", "ひ" => "ຮິ", "ふ" => "ຮຸ", "へ" => "ເຮັ", "ほ" => "ຮົ",

      # ま行
      "ま" => "ມັ", "み" => "ມິ", "む" => "ມຸ", "め" => "ເມັ", "も" => "ມົ",

      "や" => "ຢັ", "ゆ" => "ຢຸ", "よ" => "ຢົ",

      # ら行
      "ら" => "ຣັ", "り" => "ຣິ", "る" => "ຣຸ", "れ" => "ເຣັ", "ろ" => "ຣົ",

      "わ" => "ວັ", "を" => "ອົ", "ん" => "ນ",

      # が行
      "が" => "ກັ", "ぎ" => "ກິ", "ぐ" => "ກຸ", "げ" => "ເກັ", "ご" => "ກົ",

      # ざ行
      "ざ" => "ຊັ", "じ" => "ຈິ", "ず" => "ຊຸ", "ぜ" => "ເຊັ", "ぞ" => "ຊົ",

      # だ行
      "だ" => "ດັ", "ぢ" => "ຈິ", "づ" => "ສຸ", "で" => "ເດັ", "ど" => "ດົ",

      # ば行
      "ば" => "ບັ", "び" => "ບິ", "ぶ" => "ບຸ", "べ" => "ເບັ", "ぼ" => "ບົ",

      # ぱ行
      "ぱ" => "ປັ", "ぴ" => "ປິ", "ぷ" => "ປຸ", "ぺ" => "ເປັ", "ぽ" => "ປົ",

      # きゃ行
      "きゃ" => "ຄຽ", "きゅ" => "ຄິວ", "きょ" => "ຄຽວ",

      # しゃ行
      "しゃ" => "ຊຽ", "しゅ" => "ຊິວ", "しょ" => "ຊຽວ",

      # ちゃ行
      "ちゃ" => "ຈັ", "ちゅ" => "ຈຸ", "ちょ" => "ຈົ",

      # にゃ行
      "にゃ" => "ຍັ", "にゅ" => "ຍຸ", "にょ" => "ຍົ",

      # ひゃ行
      "ひゃ" => "ຮຽ", "ひゅ" => "ຮິວ", "ひょ" => "ຮຽວ",

      # みゃ行
      "みゃ" => "ມຽ", "みゅ" => "ມິວ", "みょ" => "ມຽວ",

      # りゃ行
      "りゃ" => "ຣຽ", "りゅ" => "ຣິວ", "りょ" => "ຣຽວ",

      # ぎゃ行
      "ぎゃ" => "ກຽ", "ぎゅ" => "ກິວ", "ぎょ" => "ກຽວ",

      # じゃ行
      "じゃ" => "ຈັ", "じゅ" => "ຈຸ", "じょ" => "ຈົ",

      # びゃ行
      "びゃ" => "ບຽ", "びゅ" => "ບິວ", "びょ" => "ບຽວ",

      # ぴゃ行
      "ぴゃ" => "ປຽ", "ぴゅ" => "ປິວ", "ぴょ" => "ປຽວ",

      # だぁ行
      "だぁ" => "ດາ", "でぃ" => "ດີ", "どぅ" => "ດູ", "でぇ" => "ເດ", "どぉ" => "ໂດ",

      # ヴぁ行
      "ヴぁ" => "ວັ", "ヴぃ" => "ວິ", "ヴぅ" => "ວຸ", "ヴぇ" => "ເວັ", "ヴぉ" => "ວົ"

    }

    hiragana_rows = {
      "あ" => 1, "い" => 2, "う" => 3, "え" => 4, "お" => 5,
      "か" => 1, "き" => 2, "く" => 3, "け" => 4, "こ" => 5,
      "さ" => 1, "し" => 2, "す" => 3, "せ" => 4, "そ" => 5,
      "た" => 1, "ち" => 2, "つ" => 3, "て" => 4, "と" => 5,
      "な" => 1, "に" => 2, "ぬ" => 3, "ね" => 4, "の" => 5,
      "は" => 1, "ひ" => 2, "ふ" => 3, "へ" => 4, "ほ" => 5,
      "ま" => 1, "み" => 2, "む" => 3, "め" => 4, "も" => 5,
      "や" => 1, "ゆ" => 3, "よ" => 5,
      "ら" => 1, "り" => 2, "る" => 3, "れ" => 4, "ろ" => 5,
      "わ" => 1, "を" => 5,
      "ん" => 6,
      "が" => 1, "ぎ" => 2, "ぐ" => 3, "げ" => 4, "ご" => 5,
      "ざ" => 1, "じ" => 2, "ず" => 3, "ぜ" => 4, "ぞ" => 5,
      "だ" => 1, "ぢ" => 2, "づ" => 3, "で" => 4, "ど" => 5,
      "ば" => 1, "び" => 2, "ぶ" => 3, "べ" => 4, "ぼ" => 5,
      "ぱ" => 1, "ぴ" => 2, "ぷ" => 3, "ぺ" => 4, "ぽ" => 5,
      "きゃ" => 1, "きゅ" => 3, "きょ" => 5,
      "しゃ" => 1, "しゅ" => 3, "しょ" => 5,
      "ちゃ" => 1, "ちゅ" => 3, "ちょ" => 5,
      "にゃ" => 1, "にゅ" => 3, "にょ" => 5,
      "ひゃ" => 1, "ひゅ" => 3, "ひょ" => 5,
      "みゃ" => 1, "みゅ" => 3, "みょ" => 5,
      "りゃ" => 1, "りゅ" => 3, "りょ" => 5,
      "ぎゃ" => 1, "ぎゅ" => 3, "ぎょ" => 5,
      "じゃ" => 1, "じゅ" => 3, "じょ" => 5,
      "びゃ" => 1, "びゅ" => 3, "びょ" => 5,
      "ぴゃ" => 1, "ぴゅ" => 3, "ぴょ" => 5,
      "ぁ" => 1, "ぃ" => 2, "ぅ" => 3, "ぇ" => 4, "ぉ" => 5,
      "ゃ" => 1, "ゅ" => 3, "ょ" => 5
    }

    yoon_pairs = {
      "きゃ" => "き",
      "きゅ" => "き",
      "きょ" => "き",
      "しゃ" => "し",
      "しゅ" => "し",
      "しょ" => "し",

      "ちゃ" => "ち",
      "ちゅ" => "ち",
      "ちょ" => "ち",
      "にゃ" => "に",
      "にゅ" => "に",
      "にょ" => "に",

      "ひゃ" => "ひ",
      "ひゅ" => "ひ",
      "ひょ" => "ひ",

      "みゃ" => "み",
      "みゅ" => "み",
      "みょ" => "み",

      "りゃ" => "り",
      "りゅ" => "り",
      "りょ" => "り",
      "ぎゃ" => "ぎ",
      "ぎゅ" => "ぎ",
      "ぎょ" => "ぎ",

      "じゃ" => "じ",
      "じゅ" => "じ",
      "じょ" => "じ",

      "びゃ" => "び",
      "びゅ" => "び",
      "びょ" => "び",

      "ぴゃ" => "ぴ",
      "ぴゅ" => "ぴ",
      "ぴょ" => "ぴ"

    }



    words = hiragana.split(/[　 ]/)
    lao_output = []

    words.each do |word|
      characters = word.chars
      converted_word = []
      prev_char = nil
      next_char = nil
      processed_vowel = false
      processed_set = false

      characters.each_with_index do |char, index|
        next_char = characters[index + 1] if index + 1 < characters.length
        if char == "っ"
          next
        elsif char == "ー"
          next
        elsif %w[ぁ ぃ ぅ ぇ ぉ ゃ ゅ ょ].include?(char) && prev_char && hiragana_to_lao_long[prev_char + char]
          converted_word.pop

          lao_char = if next_char == "ん"
                       hiragana_to_lao_special[prev_char + char]
          elsif next_char == "っ" || index == characters.length - 1
                       hiragana_to_lao_short[prev_char + char]
          else
                       hiragana_to_lao_long[prev_char + char]
          end
          converted_word << (lao_char || prev_char + char)
        elsif %w[あ い う え お].include?(char)
          if prev_char && hiragana_rows[prev_char] == hiragana_rows[char] && !processed_vowel
            processed_vowel = true
            next
          end
          processed_vowel = false
          if index == characters.length - 1
            converted_word << (hiragana_to_lao_short[char] || char)
          else
            converted_word << (hiragana_to_lao_long[char] || char)
          end
        elsif index == characters.length - 1
          converted_word << (hiragana_to_lao_short[char] || char)
        else
          if next_char == "っ"
            converted_word << (hiragana_to_lao_short[char] || char)
          elsif next_char == "ん"
            converted_word << (hiragana_to_lao_special[char] || char)
          else
            converted_word << (hiragana_to_lao_long[char] || char)
          end
        end

        prev_char = char
      end
      lao_output << converted_word.join
    end

    lao_output.join(" ")
  end
end
